<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: layout(~{::title}, ~{::div.content})}">
<head>
    <title>Plan Detail</title>
</head>
<div class="content">
    <div class="page-header">
        <div>
            <h1><span th:text="${currentPlan.activityTypeIcon}"></span> <span th:text="${currentPlan.activityType}"> Plan</span></h1>
            <div class="breadcrumb">
                <a th:href="@{/package}">ğŸ“¦ Packages</a> /
                <a th:href="@{/package/{id}(id=${currentPackage.id})}" th:text="${currentPackage.packageName}"></a> /
                <span>Plan Detail</span>
            </div>
        </div>
        <span class="status-badge-large"
              th:text="${currentPlan.status}"
              th:classappend="${currentPlan.status == 'Processed' ? 'status-processed' : 
                              currentPlan.status == 'Pending' ? 'status-pending' : 'status-unfinished'}">
        </span>
    </div>

    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

    <!-- Plan Info Section -->
    <div class="detail-container">
        <div class="info-card highlight-card">
            <div class="card-icon">ğŸ’°</div>
            <div>
                <div class="card-label">Total Plan Price</div>
                <div class="card-value" th:text="${currentPlan.formattedPrice}"></div>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <div class="card-icon-sm">ğŸ†”</div>
                <div>
                    <div class="card-label">Plan ID</div>
                    <div class="card-value-sm" th:text="${currentPlan.id}"></div>
                </div>
            </div>

            <div class="info-card">
                <div class="card-icon-sm" th:text="${currentPlan.activityTypeIcon}"></div>
                <div>
                    <div class="card-label">Activity Type</div>
                    <div class="card-value-sm" th:text="${currentPlan.activityType}"></div>
                </div>
            </div>

            <div class="info-card">
                <div class="card-icon-sm">ğŸ“¦</div>
                <div>
                    <div class="card-label">Package</div>
                    <div class="card-value-sm" th:text="${currentPackage.packageName}"></div>
                </div>
            </div>
        </div>

        <!-- Location & Schedule Section -->
        <div class="timeline-section">
            <h2 class="section-title">ğŸ“ Location & Schedule</h2>
            <div class="location-info">
                <div class="location-item">
                    <div class="location-icon">ğŸ›«</div>
                    <div>
                        <div class="location-label">Start Location</div>
                        <div class="location-value" th:text="${currentPlan.startLocation}"></div>
                    </div>
                </div>

                <div class="location-connector">â†’</div>

                <div class="location-item">
                    <div class="location-icon">ğŸ›¬</div>
                    <div>
                        <div class="location-label">End Location</div>
                        <div class="location-value" th:text="${currentPlan.endLocation}"></div>
                    </div>
                </div>
            </div>

            <div class="schedule-info">
                <div class="schedule-item">
                    <div class="schedule-label">Start Date & Time</div>
                    <div class="schedule-value" th:text="${#temporals.format(currentPlan.startDate, 'EEEE, dd MMMM yyyy HH:mm')} + ' WIB'"></div>
                </div>
                <div class="schedule-item">
                    <div class="schedule-label">End Date & Time</div>
                    <div class="schedule-value" th:text="${#temporals.format(currentPlan.endDate, 'EEEE, dd MMMM yyyy HH:mm')} + ' WIB'"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ordered Quantities Section -->
    <div class="ordered-quantities-section">
        <div class="section-header">
            <h2 class="section-title">ğŸ« Ordered Activities</h2>
            <a th:href="@{/package/{packageId}/plan/{planId}/ordered-quantity/create(packageId=${currentPackage.id}, planId=${currentPlan.id})}"
               class="btn btn-primary"
               th:if="${currentPlan.status != 'Processed'}">
                â• Add Activity
            </a>
        </div>

        <div th:if="${currentPlan.orderedQuantities.isEmpty()}" class="empty-state-small">
            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ«</div>
            <p>No activities ordered yet. Start by adding activities to this plan!</p>
        </div>

        <div th:if="${not currentPlan.orderedQuantities.isEmpty()}" class="ordered-grid">
            <div th:each="oq : ${currentPlan.orderedQuantities}" class="ordered-card">
                <div class="ordered-header">
                    <h3 th:text="${oq.activityName}">Activity Name</h3>
                    <span class="ordered-price" th:text="${oq.formattedTotalPrice}">Total Price</span>
                </div>

                <div class="ordered-info">
                    <div class="info-row">
                        <span class="info-label">ğŸ“¦ Item:</span>
                        <span th:text="${oq.activityItem}"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ğŸ‘¥ Ordered Quantity:</span>
                        <span th:text="${oq.orderedQuota} + ' / ' + ${oq.quota}"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ğŸ’µ Unit Price:</span>
                        <span th:text="${oq.formattedPrice}"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ğŸ“… Schedule:</span>
                        <span th:text="${#temporals.format(oq.startDate, 'dd MMM yyyy HH:mm')} + ' - ' + ${#temporals.format(oq.endDate, 'dd MMM yyyy HH:mm')}"></span>
                    </div>
                </div>

                <div class="ordered-actions" th:if="${currentPlan.status != 'Processed'}">
                    <a th:href="@{/package/{packageId}/plan/{planId}/ordered-quantity/update/{oqId}(packageId=${currentPackage.id}, planId=${currentPlan.id}, oqId=${oq.id})}"
                       class="btn-action btn-edit">âœï¸ Edit</a>
                    <form th:action="@{/package/{packageId}/plan/{planId}/ordered-quantity/{oqId}/delete(packageId=${currentPackage.id}, planId=${currentPlan.id}, oqId=${oq.id})}"
                          method="POST" style="display: inline;">
                        <button type="submit" class="btn-action btn-delete"
                                onclick="return confirm('âš ï¸ Remove this activity from plan?')">ğŸ—‘ï¸ Remove</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-bar">
        <a th:href="@{/package/{id}(id=${currentPackage.id})}" class="btn btn-secondary">â† Back to Package</a>
        <div style="display: flex; gap: 10px;" th:if="${currentPlan.status != 'Processed'}">
            <a th:href="@{/package/{packageId}/plan/{planId}/update(packageId=${currentPackage.id}, planId=${currentPlan.id})}"
               class="btn btn-primary">âœï¸ Edit Plan</a>
            <form th:action="@{/package/{packageId}/plan/{planId}/process(packageId=${currentPackage.id}, planId=${currentPlan.id})}"
                  method="POST" style="display: inline;">
                <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #00b894, #00875a);">
                    âœ… Process Plan
                </button>
            </form>
            <form th:action="@{/package/{packageId}/plan/{planId}/delete(packageId=${currentPackage.id}, planId=${currentPlan.id})}"
                  method="POST" style="display: inline;">
                <button type="submit" class="btn btn-danger"
                        onclick="return confirm('âš ï¸ Delete this plan?')">ğŸ—‘ï¸ Delete Plan</button>
            </form>
        </div>
    </div>

    <style>
        .breadcrumb {
            font-size: 0.9em;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .breadcrumb a {
            color: var(--coral-primary);
            text-decoration: none;
            font-weight: 600;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
        }

        .status-badge-large {
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: var(--shadow-md);
        }

        .status-processed {
            background: linear-gradient(135deg, #d4edda, #a8e6cf);
            color: #155724;
        }

        .status-pending {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
        }

        .status-unfinished {
            background: linear-gradient(135deg, #dfe6e9, #b2bec3);
            color: #2d3436;
        }

        .detail-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 40px;
        }

        .info-card {
            padding: 25px;
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--coral-primary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .info-card:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-md);
        }

        .highlight-card {
            background: linear-gradient(135deg, #fff8f5, #ffe5d9);
            border-left: 6px solid var(--success-color);
            padding: 35px;
        }

        .card-icon {
            font-size: 3em;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
        }

        .card-icon-sm {
            font-size: 2em;
        }

        .card-label {
            font-size: 0.85em;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .card-value {
            font-size: 2.5em;
            font-weight: 800;
            color: var(--success-color);
        }

        .card-value-sm {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--text-dark);
            word-break: break-all;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .timeline-section {
            background: linear-gradient(135deg, #fff8f5, #ffe5d9);
            padding: 40px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .section-title {
            font-size: 1.8em;
            color: var(--text-dark);
            margin-bottom: 35px;
            font-weight: 800;
        }

        .location-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }

        .location-item {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .location-icon {
            font-size: 3em;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
        }

        .location-label {
            font-size: 0.85em;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .location-value {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-dark);
        }

        .location-connector {
            font-size: 2em;
            color: var(--coral-primary);
            font-weight: 700;
        }

        .schedule-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .schedule-item {
            padding: 20px;
            background: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }

        .schedule-label {
            font-size: 0.85em;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .schedule-value {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--text-dark);
        }

        .ordered-quantities-section {
            background: white;
            padding: 40px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-top: 40px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .empty-state-small {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, #fff8f5, #ffe5d9);
            border-radius: var(--radius-md);
            border: 2px dashed var(--coral-primary);
        }

        .ordered-grid {
            display: grid;
            gap: 25px;
        }

        .ordered-card {
            background: linear-gradient(135deg, #fff8f5, #ffe5d9);
            border-radius: var(--radius-md);
            padding: 25px;
            box-shadow: var(--shadow-sm);
            border-left: 5px solid var(--coral-primary);
            transition: all 0.3s ease;
        }

        .ordered-card:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-lg);
        }

        .ordered-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--peach-light);
        }

        .ordered-header h3 {
            margin: 0;
            color: var(--text-dark);
            font-size: 1.3em;
        }

        .ordered-price {
            font-size: 1.4em;
            font-weight: 800;
            color: var(--success-color);
        }

        .ordered-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            gap: 10px;
            font-size: 0.95em;
        }

        .info-label {
            font-weight: 600;
            color: var(--text-muted);
            min-width: 150px;
        }

        .ordered-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding-top: 15px;
            border-top: 1px solid var(--peach-light);
        }

        .btn-action {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            text-decoration: none;
            color: white;
        }

        .btn-edit {
            background: linear-gradient(135deg, var(--coral-primary), var(--coral-dark));
        }

        .btn-delete {
            background: linear-gradient(135deg, #ff6b6b, var(--danger-color));
        }

        .btn-action:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid var(--peach-light);
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: 15px;
            }

            .location-info {
                flex-direction: column;
                gap: 20px;
            }

            .location-connector {
                transform: rotate(90deg);
            }

            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .action-bar {
                flex-direction: column;
            }

            .action-bar > div {
                width: 100%;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .ordered-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .ordered-actions {
                justify-content: flex-start;
            }
        }
    </style>
</div>
</html>